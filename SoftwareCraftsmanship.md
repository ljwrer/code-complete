# Software Craftsmanship

## 布局

### 概述

- 程序源代码的布局
- 出色的编排

	- 视觉上和思维上的愉悦
	- 艺术上的满足
	- 理解代码、检查代码以及修改代码变得更容易
	- 代码在初始质量和最终维护性能都出类拔萃

### 基本原则

- 基本原理

	- 好的布局凸显程序的逻辑结构
	- 展示出代码的结构

		- 着重逻辑表现通常并不会做出难看的代码

- 人看程序总倾向于从代码的视觉外观获取提示

	- 好的布局方案的关键是能使程序的外观与逻辑结构结构相符，也就是要让人和计算机对其有同样的理解

- 作用

	- 程序规划知识和编程论述规则对我们理解程序有着深远影响

		- 心理因素
		- 编程工作量的一小部分是写让机器读的程序，大部分是写能让他人看懂的程序

	- 结构能帮助高手去感知、理解和记住程序的重要特性。编程高手通常会恪守自己的风格并前后如一

- 信仰

	- 美学+逻辑问题

		- 头脑开放

- 良好布局的目标

	- 明确的方案
	- 准确表现代码的逻辑结构

		- 缩进、空白

	- 始终如一地表现代码的逻辑结构

		- 好的风格能适应大多数情况

	- 改善可读性
	- 经得起修改

		- 不必连带修改

- 实施

	- 多方法衡量

### 布局技术

- 空白

	- 空白能够增强可读性。空白包括空格、制表符、换行、空行，是展现程序结构的主要手段
	- 作者的组织方式正是理解有关主题逻辑结构的最重要线索
	- 程序里包含信息密度超过多数书籍的信息密度

		- 程序应该比书提供更多的组织方式

- 分组

	- 空白也是分组
	- 一段代码只应由完成某任务的语句组成，这些语句彼此相关

- 空行

	- 代码中的一个段落的前面也应该加入空行

		- 8%-16%

- 缩进

	- 用缩进形式显示程序的逻辑结构

		- 缩进确实能提高程序员的理解能力
		- 多程序的逻辑结构强调不足或过分都不合适

			- 缩进二到四个空格最得当

- 括号

	- 括号应该用的比你觉得需要的更多

		- 尤其是求值顺序有疑问的表达式

### 布局风格

- 纯块布局

	- 关于布局的争论源于许多常用语言的内在缺陷
	- 很多缩进问题之所以存在，就是因为你得去弥补语言结构的不良设计

- 模拟纯块布局

	- 将关键词begin和end（或者大括号）看成是所在控制结构的扩展

- 使用大括号对指定块边界

	- 将begin和end视为控制结构下的语句，而非控制语句的一部分

		- 无法精确适用于C++和Java中的switch/case语句

- 行尾布局

	- 一大组代码缩进至行中间或结尾的布局策略

		- 语句复杂时，会提供无用或误导的逻辑结构信息
		- 不精确，很难持久应用，不易维护

- 策略

	- java

		- 标准纯块缩进结构

	- C++

		- 模拟纯块布局或使用大括号对指定块边界

### 逻辑结构布局

- 控制结构的布局影响可读性和可理解性
- 要点

	- 不要使用未缩进的begin-end对

		- 显示出代码的逻辑结构

			- begin和end是逻辑结构的一部分

	- 别让begin和end两次缩进
	- 段落之间使用空行

		- 促使你更努力地去把语句分组
		- 为注释提供空间

	- 单语句代码块的格式前后统一

		- 陷阱

			- 缩进结构会让你自以为代码正确

		- 推荐使用纯块布局

			- 开头可以使用单行，但不推荐

	- 对于复杂表达式，将条件分隔放在几行上

		- 或者布尔函数

	- 不用goto

		- 转到的标号全部使用大写字母表示
		- 包含goto的语句单独为一行
		- goto语句转到的标号单独为一行且上下为空行

	- case语句不要有行尾布局的例外

		- 使用标准缩进增量

### 单语句布局

- 语句长度

	- 80个字符以内
	- 不鼓励深度嵌套
	- 便于打印和显示器

- 使用空格使语句显得清楚

	- 使逻辑表达式更易读

		- 额外的空格极少起负面作用

	- 让数组引用更容易读
	- 让子程序参数更容易读

		- 参数位置对过程化语言很重要

- 格式化后续行（长语句）

	- 使续行明显

		- 将第一行部分做成若其单独时就有明显语法错误的样子（+、&&结尾）

			- 断句也有助于防止不当的修改

		- 将后续的字符置于后续行的开头（+、&&开头）

			- 便于阅读
			- 标明运算的结构

		- 把紧密关联的元素放在一起

			- 数组下标
			- 子程序参数

	- 让后续行的结尾易于发现

		- 每个参数占一行，最后用右括号括起来以示参数结束

	- 将控制语句的后续行缩进以标准的空格数

		- 布尔函数替代
		- 微调时考虑可维护性

	- 将子程序调用的后续行按标准量缩进
	- 不要将赋值语句按等号对齐
	- 对赋值语句后续行按标准量缩进

		- 通用的可读性和可维护性

- 每行仅写一条语句

	- 理由

		- 提供有关程序复杂性的准确观点
		- 对于现代编译器与优化无关
		- 代码仅需自上而下阅读
		- 编译器指出行号错误时更容易找出语法错误
		- 在调试器中更容易单步执行代码
		- 编辑单个语句更加容易

	- C++中不要让一行里有多个操作（副作用）

		- 如f(++i,i+2)
		- 副作用使代码难以看懂

			- “认得”而不理解的代码容易产生难以发现的错误
			- 代码不应该隐藏操作的复杂性

		- 性能的改善并不靠将多个操作置于一行实现

			- 先求清晰正确，其次才是执行效率

- 数据声明布局

	- 每行只声明一个数据

		- 注释方便
		- 便于修改
		- 容易查找
		- 编译器错误根据行号容易排查
		- 每行一个变量，每行的声明也完整，都包含有变量类型

	- 变量声明尽量接近其首次使用的位置

		- 减少跨度和生存期
		- 便于重构

	- 合理组织声明顺序

		- 声明按类型分组
		- 数量极多可以考虑按字母排序以便于查找

	- C++中，声明指针变量时把星号（*）靠近变量名，或者是去声明指针类型

		- 推荐所有指针都用指针类型声明或者每行只声明一个变量

### 注释的布局

- 概述

	- 注释做得好可大大增进程序的可读性，而糟糕的注释却会帮倒忙

- 注释的缩进要与相应代码一致

	- 注释未必是好事，干扰了对程序的扫视
	- 注释的风格有力地影响着注释是否具有负面作用

- 每行注释用至少一个空行分开

### 子程序布局

- 用空行分隔子程序的各部分

	- 头、数据、常量、子程序体

- 将子程序参数按标准缩进

	- 每个参数占一行

		- 既美观，维护量也小

### 类的布局

- 类接口的布局

	- 说明类及其完整用法的头部注释
	- 构造函数与析构函数
	- public子程序
	- protected子程序
	- private子程序

- 类实现的布局

	- 描述类所在文件之内容的头部注释
	- 类数据
	- public子程序
	- protected子程序
	- private子程序

- 如果文件包含多个类，要清楚地标出每一个类

	- 类就像书的“章”
	- 不要在类里过度注释
	- 很多内容用星号突出，以至于没有什么东西被真正强调了

		- 采用一系列的符号（从紧到松）

			- 类分隔用星号
			- 子程序间用连字号（减号）
			- 重要的注释使用空行
			- 避免将两行星号或者连字号放在一块

	- 除非确实有充足理由（例如将若干小类组织到一起），请在一个文件中只放一个类

		- 依旧可以用上面的技术分隔子程序组

- 文件和程序布局

	- 一个文件应该只有一个类

		- 一个文件应该是“支持且仅支持一项目的”的一组子程序的集合

			- 文件应该强化这一子程序集合同属于一个类的思想

		- 类是语言里的语义概念，文件则是操作系统中的物理概念

			- 类和文件之间的对应只是一种巧合，越来越多的环境支持将代码放入数据库

	- 文件的命名应与类名有关

		- 一一对应

	- 在文件中清晰地分隔各子程序

		- 至少用两个空行将子程序分开

			- 空行与星号行、连字号一样有效，而其输入和维护却容易得多

	- 按字母顺序排列子程序

		- 替代方案，节约查找时间

	- C++组织源文件中内容的次序

		- 文件的描述性注释
		- #include文件行
		- 在多个类里使用的常量定义（如果文件有多个类）
		- 在多个类里使用的枚举（如果文件里有多个类）
		- 宏函数定义
		- 在多个类里使用的类型定义（如果文件里有多个类）
		- 导入的全局变量和函数
		- 导出的全局变量和函数
		- 本文件私用的变量和函数
		- 各个类，包括各个类中的常量定义、枚举以及类型定义

### 引言

- 文学化编程

### 要点

- 可视化布局的首要任务是指明代码的逻辑组织

*XMind: ZEN - Trial Version*